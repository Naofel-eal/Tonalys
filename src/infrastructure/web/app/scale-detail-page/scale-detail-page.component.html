@let scale = (scale$ | async)!;

<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/" text="Scales"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <span class="tonic">{{ scale.tonic.name }} </span> 
      <span class="mode">{{ scale.mode.name }}</span>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  <div class="content-wrapper">
    <section class="scale-overview">
      <div class="section-header">
        <h2 class="section-title">Scale Structure</h2>
        <p class="section-description">Complete visualization of the scale on piano</p>
      </div>
      
      <div class="scale-content">
        <div class="notes-showcase">
          <div class="notes-label">Scale Notes</div>
          <div class="notes-display">
            @for (note of scale.notes; track note.name) {
              <div class="note-item" [class.root-note]="note.name === scale.tonic.name">
                <span class="note-name">{{ note.name }}</span>
              </div>
            }
          </div>
        </div>

        <div class="piano-section">
          <app-piano-octave
            [notesToHighlight]="scale.notes"
            [rootNote]="scale.tonic">
          </app-piano-octave>
        </div>
      </div>
    </section>

    @if (scale.chords.length) {
      <section class="chords-section">
        <div class="section-header">
          <h2 class="section-title">Scale Harmonization</h2>
          <p class="section-description">All chords that can be built from this scale</p>
        </div>

        <div class="chords-grid">
          @for (chord of scale.chords; track $index) {
            <article class="chord-card">
              <div class="chord-header">
                <div class="chord-info">
                  <h3 class="chord-name">
                    <span class="chord-root">{{ chord.root.name }}</span>
                    <span class="chord-quality">{{ chord.quality.name }}</span>
                  </h3>
                </div>
              </div>

              <div class="chord-content">
                <div class="chord-notes">
                  <div class="notes-label">Chord Tones</div>
                  <div class="chord-notes-grid">
                    @for (note of chord.notes; track note.name) {
                      <span class="chord-note" [class.chord-root]="note.name === chord.root.name">
                        {{ note.name }}
                      </span>
                    }
                  </div>
                </div>

                <app-piano-octave
                  [notesToHighlight]="chord.notes"
                  [rootNote]="chord.root">
                </app-piano-octave>
              </div>
            </article>
          }
        </div>
      </section>
    } @else {
      <section class="empty-chords">
        <div class="empty-state">
          <div class="empty-icon">
            <ion-icon name="list-outline" size="large"></ion-icon>
          </div>
          <h3 class="empty-title">No chords available</h3>
          <p class="empty-description">Chord information is not available for this scale</p>
        </div>
      </section>
    }
  </div>
</ion-content>